# Complete Codebase Explanation: Tap to Purr Game

## ğŸ“ Folder Structure Overview

```
tap-to-purr/
â”œâ”€â”€ dist/                    # Built production files (generated by Vite)
â”œâ”€â”€ node_modules/            # Dependencies (React, Vite, etc.)
â”œâ”€â”€ public/                  # Static assets served as-is
â”œâ”€â”€ src/                     # Source code
â”‚   â”œâ”€â”€ assets/             # Images (PNG files for game objects)
â”‚   â”œâ”€â”€ game/               # Core game logic and components
â”‚   â”œâ”€â”€ hooks/              # Custom React hooks
â”‚   â”œâ”€â”€ *.jsx               # Screen components (Home, Splash, etc.)
â”‚   â”œâ”€â”€ *.css               # Styles for each component
â”‚   â”œâ”€â”€ App.jsx             # Main app with routing logic
â”‚   â”œâ”€â”€ main.jsx            # Entry point
â”‚   â””â”€â”€ index.css           # Global styles
â”œâ”€â”€ package.json            # Dependencies and scripts
â”œâ”€â”€ vite.config.js         # Vite build configuration
â””â”€â”€ index.html             # HTML entry point
```

---

## ğŸ“„ File-by-File Breakdown

### **Entry Points**

#### `src/main.jsx`
- **Purpose**: React application entry point
- **What it does**: 
  - Imports React and ReactDOM
  - Renders the `<App />` component into the DOM root element
  - Wraps app in `<StrictMode>` for development warnings

#### `index.html`
- **Purpose**: HTML template
- **What it does**: Contains the root `<div id="root">` where React mounts

---

### **Core Application**

#### `src/App.jsx` â­ **ROUTING LOGIC HERE**
- **Purpose**: Main application component that handles ALL routing/navigation
- **Key Features**:
  - **NO React Router library** - uses conditional rendering based on `screen` state
  - Manages global state: progress, user data, session score
  - Handles localStorage for persistence
  - **Screen States**:
    - `'splash'` â†’ SplashScreen
    - `'home'` â†’ Home component
    - `'signup'` â†’ SignupScreen
    - `'starting'` â†’ StartingScreen (countdown)
    - `'game'` â†’ Game component
    - `'gameover'` â†’ GameOver screen
    - `'levels'` â†’ LevelsScreen
    - `'upload'` â†’ UploadScreen
  - **Navigation Flow**:
    ```
    Splash â†’ Home â†’ Signup â†’ Login â†’ Starting â†’ Game â†’ GameOver â†’ Home
    ```
  - **Functions**:
    - `loadProgress()` / `saveProgress()` - XP and activities persistence
    - `loadUserData()` / `saveUserData()` - User info persistence
    - Various handlers for screen transitions

---

### **Game Components** (`src/game/`)

#### `src/game/Game.jsx` ğŸ® **MAIN GAME COMPONENT**
- **Purpose**: The actual playable game screen
- **Key Features**:
  - 30-second game timer
  - Uses `useGameState` hook for game logic
  - Uses `useTouchHandler` for input handling
  - **Animation Loop**: Uses `requestAnimationFrame` for smooth 60fps animations
  - **Physics**:
    - Objects move with velocity (`vx`, `vy`)
    - Bounce off screen edges
    - Collision detection and separation
    - Rotation animation
  - **Rendering**: SVG-based (all game objects are SVG elements)
  - **HUD**: Score, timer, level info, pause button
  - **End Modal**: Shows score, XP earned, level-up status

#### `src/game/FloatingObject.jsx` ğŸˆ
- **Purpose**: Renders individual floating game objects
- **What it does**:
  - Displays objects as either:
    - **Images** (for level 0: fish, star, bowl, clouds PNGs)
    - **SVG paths** (for other levels: geometric shapes)
  - Applies transformations:
    - Position (`translate`)
    - Scale (0.8-1.2x)
    - Rotation (continuous spinning)
    - Opacity (fade-in on spawn)
  - Adds glow effects for SVG objects

#### `src/game/Background.jsx` ğŸŒ…
- **Purpose**: Renders game background
- **What it does**:
  - Level 0: Uses `gameBackground.png` image
  - Other levels: Gradient backgrounds (3-color linear gradients)
  - Smooth fade-in animation on load
  - `BackgroundDefs`: Pre-renders gradients for smooth transitions

#### `src/game/Ripple.jsx` ğŸ’«
- **Purpose**: Ripple effect when object is collected
- **What it does**:
  - Uses Web Animations API (`element.animate()`)
  - Expands from 10px to 80px radius
  - Fades out over 500ms
  - Removes itself when animation completes

#### `src/game/PointPopup.jsx` âœ¨
- **Purpose**: "+X" text that appears when collecting objects
- **What it does**:
  - Custom animation using `requestAnimationFrame`
  - **3-stage animation**:
    1. Bounce in (0-20%): Scale 0.5 â†’ 1.2, fade in
    2. Float up (20-70%): Move up 70px, scale to 1.0
    3. Fade out (70-100%): Continue up, fade to 0
  - Font size varies by points (1pt=32px, 2pt=36px, 3pt=40px)
  - Glow effect using CSS filters

#### `src/game/levels.js` ğŸ“Š
- **Purpose**: Game configuration and level definitions
- **What it contains**:
  - **LEVELS array**: 5 levels with:
    - XP requirements
    - Background colors
    - Object types per level
    - Color palettes
    - UI colors
  - **OBJECT_SHAPES**: SVG path definitions for each object type
  - **Constants**:
    - `OBJECT_SIZE = 140` (pixels)
    - `MAX_OBJECTS = 6`
    - `MIN_OBJECT_DISTANCE = 200`
    - `TAP_RADIUS = 250`
    - `OBJECT_SPEED = 0.3`
  - **Functions**:
    - `getLevelForXP(totalXP)` - Returns current level index
    - `getNextLevelXP(levelIndex)` - Returns XP needed for next level
  - **OBJECT_POINTS**: Points per object type (1-3 points)

#### `src/game/sounds.js` ğŸ”Š
- **Purpose**: Audio feedback (NO external library!)
- **What it does**:
  - Uses **Web Audio API** (native browser API)
  - `playChime(pitch)`: Generates sine wave tones
    - Uses pentatonic scale (5 notes: C, D, E, G, A)
    - Gentle frequencies (523-880 Hz)
    - Short decay (0.4s)
    - Low volume (0.08 gain)
  - `tryVibrate()`: Uses Vibration API for haptic feedback (30ms pulse)
  - **No external audio libraries** - pure browser APIs

---

### **Custom Hooks** (`src/hooks/`)

#### `src/hooks/useGameState.js` ğŸ¯
- **Purpose**: Manages all game state logic
- **State Management**:
  - `score` - Current points
  - `objects` - Array of floating objects
  - `ripples` - Active ripple effects
  - `pointPopups` - Active "+X" popups
- **Key Functions**:
  - `initObjects(w, h)` - Creates 6 random objects with collision avoidance
  - `collectNearest(x, y)` - Finds nearest object to tap, collects it, spawns new one
  - `resetGame()` - Resets score and objects
  - `updateScreenSize(w, h)` - Handles window resize
- **Object Creation**:
  - Random type from level's object list
  - Random color from level's palette
  - Random position (with collision avoidance)
  - Random velocity (-0.3 to 0.3 px/frame)
  - Random scale (0.8-1.2x)
  - Random rotation speed

#### `src/hooks/useTouchHandler.js` ğŸ‘†
- **Purpose**: Handles touch/mouse input with debouncing
- **What it does**:
  - Prevents duplicate taps (200ms debounce)
  - Tracks touch IDs to prevent double-processing
  - Handles both touch events and mouse events
  - Filters out taps too close together (< 20px, < 200ms)

---

### **Screen Components**

#### `src/SplashScreen.jsx` ğŸ¬
- **Purpose**: Loading screen on app start
- **Features**:
  - Progress bar animation (0-100% over 2.5 seconds)
  - Fade-out transition
  - Decorative elements (clouds, fish, bowl)

#### `src/Home.jsx` ğŸ 
- **Purpose**: Main menu/home screen
- **Features**:
  - Play button (starts game flow)
  - Upload video button
  - Prize showcase section
  - Reset XP button (hidden, top-left corner)

#### `src/SignupScreen.jsx` ğŸ“
- **Purpose**: User registration form
- **Collects**: Full name, email, phone

#### `src/StartingScreen.jsx` â±ï¸
- **Purpose**: Pre-game countdown (3, 2, 1, GO!)
- **Triggers**: `onCountdownComplete` â†’ starts game

#### `src/GameOver.jsx` ğŸ
- **Purpose**: Post-game results screen
- **Shows**: Score, XP earned, level progress, level-up notification
- **Actions**: Play Again, Go Home, Unlock Themes

#### `src/LevelsScreen.jsx` ğŸ“ˆ
- **Purpose**: Progress tracking screen
- **Shows**: 
  - Total XP
  - Videos uploaded count
  - Activity history (last 10 activities)
  - User profile info

#### `src/UploadScreen.jsx` ğŸ“¤
- **Purpose**: Video upload interface
- **Features**: File picker, upload handler

#### `src/LoginModal.jsx` & `src/HowToPlayModal.jsx` ğŸªŸ
- **Purpose**: Modal overlays
- **Features**: Overlay with backdrop blur

---

## ğŸ”„ How "Routing" Works (No React Router!)

This app **does NOT use React Router**. Instead, it uses **conditional rendering**:

```jsx
// In App.jsx
const [screen, setScreen] = useState('splash');

// Conditional rendering based on screen state
if (screen === 'splash') return <SplashScreen />;
if (screen === 'home') return <Home />;
if (screen === 'game') return <Game />;
// ... etc
```

**Navigation Flow**:
1. User action triggers handler (e.g., `onStartGame`)
2. Handler calls `setScreen('newScreen')`
3. React re-renders App component
4. Conditional logic shows new screen component
5. Old component unmounts, new one mounts

**Advantages**:
- No external dependency
- Simple for small apps
- Full control over transitions

**Disadvantages**:
- No URL routing (can't bookmark specific screens)
- No browser back button support
- Manual state management

---

## ğŸ® How the Game Works

### **Game Loop (Animation)**

The game uses **`requestAnimationFrame`** for smooth 60fps animations:

```jsx
// In Game.jsx, lines 89-165
useEffect(() => {
  function animate() {
    setObjects(prev => {
      // 1. Update positions
      const updated = prev.map(obj => {
        x += vx;  // Move object
        y += vy;
        // Bounce off edges
        if (x < 0 || x > width) vx = -vx;
        if (y < 0 || y > height) vy = -vy;
        rotation += rotationSpeed;  // Rotate
        return { ...obj, x, y, vx, vy, rotation };
      });
      
      // 2. Check collisions and push apart
      // 3. Limit velocity
      return collisionAdjusted;
    });
    requestAnimationFrame(animate);  // Loop!
  }
  requestAnimationFrame(animate);
}, []);
```

### **How Objects Float**

Objects "float" through **physics simulation**:

1. **Velocity-Based Movement**:
   - Each object has `vx` (horizontal velocity) and `vy` (vertical velocity)
   - Every frame: `x += vx`, `y += vy`
   - Velocities are small (0.3 px/frame) for smooth movement

2. **Boundary Collision**:
   - When object hits edge, velocity reverses: `vx = -vx` or `vy = -vy`
   - Position clamped to screen bounds

3. **Object-to-Object Collision**:
   - Checks distance between object centers
   - If too close (< 200px), pushes them apart
   - Adjusts velocities to separate objects

4. **Rotation**:
   - Each object has `rotationSpeed` (-0.3 to 0.3 degrees/frame)
   - Continuously rotates: `rotation = (rotation + rotationSpeed) % 360`

5. **Visual Effects**:
   - Scale variation (0.8-1.2x) for depth
   - Opacity fade-in on spawn
   - Glow effects for SVG objects

### **Object Collection**

When user taps:
1. `useTouchHandler` detects tap position
2. `collectNearest(x, y)` finds closest object
3. Object removed, score increased
4. Ripple effect spawned at tap location
5. "+X" popup spawned
6. New object spawned (avoiding collisions)
7. Sound plays (Web Audio API chime)
8. Vibration triggers (if supported)

---

## ğŸ¨ Animation & Visual Effects

### **No External Animation Libraries!**

All animations use **native browser APIs**:

1. **CSS Animations** (`@keyframes`):
   - Modal fade-in/slide-up
   - Background fade-in
   - Splash screen transitions

2. **Web Animations API** (`element.animate()`):
   - Ripple effects (Ripple.jsx)
   - Smooth, performant animations

3. **requestAnimationFrame**:
   - Game loop (object movement)
   - Point popup animation (PointPopup.jsx)
   - Custom timing control

4. **CSS Transitions**:
   - Hover effects
   - Color changes
   - Opacity fades

5. **SVG Animations**:
   - Background gradient transitions
   - Object rotation transforms

---

## ğŸµ Audio System

### **No External Audio Libraries!**

Uses **Web Audio API** (native browser API):

```javascript
// In sounds.js
const ctx = new AudioContext();
const osc = ctx.createOscillator();  // Sound generator
const gain = ctx.createGain();        // Volume control

osc.type = 'sine';                    // Waveform type
osc.frequency.value = 523.25;         // Pitch (Hz)
gain.gain.setValueAtTime(0.08, ...);  // Volume
gain.gain.exponentialRampToValueAtTime(0.001, ...);  // Fade out

osc.connect(gain);
gain.connect(ctx.destination);
osc.start();
osc.stop(ctx.currentTime + 0.4);      // 400ms duration
```

**Features**:
- Pentatonic scale (5 harmonious notes)
- Low volume (cat-friendly)
- Short duration (0.4s)
- Exponential decay (smooth fade)

**Haptic Feedback**:
- Uses `navigator.vibrate(30)` for 30ms pulse
- Only on supported devices (mobile)

---

## ğŸ¯ Game Mechanics Summary

1. **Objective**: Tap floating objects to collect points
2. **Duration**: 30 seconds per game
3. **Scoring**: 1-3 points per object (varies by type)
4. **Progression**: XP system unlocks new levels
5. **Levels**: 5 levels with different themes, objects, colors
6. **Physics**: Objects float, bounce, rotate, avoid collisions
7. **Feedback**: Visual (ripples, popups), audio (chimes), haptic (vibration)

---

## ğŸ› ï¸ Technology Stack

- **React 19.2.0** - UI framework
- **Vite 7.2.4** - Build tool & dev server
- **No routing library** - Conditional rendering
- **No animation library** - Native APIs (requestAnimationFrame, Web Animations API)
- **No audio library** - Web Audio API
- **SVG** - All game graphics (with PNG images for level 0)
- **CSS** - Styling and transitions
- **localStorage** - Data persistence

---

## ğŸ“Š Data Flow

```
User Action
    â†“
Event Handler (App.jsx)
    â†“
State Update (setScreen, setProgress, etc.)
    â†“
Component Re-render
    â†“
Props Passed Down
    â†“
Child Components Update
    â†“
localStorage (if needed)
```

**State Management**:
- App-level state in `App.jsx` (screen, progress, userData)
- Game state in `useGameState` hook (score, objects, effects)
- Persistence via localStorage

---

## ğŸ¨ Visual Design

- **Glassmorphism**: Backdrop blur effects on UI elements
- **Gradient Backgrounds**: 3-color linear gradients per level
- **Glow Effects**: Radial gradients for object glow
- **Smooth Animations**: 60fps via requestAnimationFrame
- **Responsive**: Adapts to screen size (window.innerWidth/Height)

---

This is a **pure React game** with no external game engines or heavy libraries - everything is built with React, SVG, and native browser APIs! ğŸ®âœ¨

